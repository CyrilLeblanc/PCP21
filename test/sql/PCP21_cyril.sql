-- MySQL Script generated by MySQL Workbench
-- Thu Jun  3 13:29:12 2021
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering


-- SCRIPT MODIFIÉ POUR CONVENIR À LA DÉMONSTRATION DE CYRIL LEBLANC

DROP DATABASE IF EXISTS `PCP21`;

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema PCP21
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `PCP21` DEFAULT CHARACTER SET utf8 ;
USE `PCP21` ;

-- -----------------------------------------------------
-- Table `PCP21`.`Point_RDV`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `PCP21`.`Point_RDV` (
  `idPoint_RDV` INT NOT NULL AUTO_INCREMENT,
  `Nom` VARCHAR(45) NULL,
  `Latitude` FLOAT(10,5) NULL,
  `Longitude` FLOAT(10,5) NULL,
  `Adresse` VARCHAR(45) NULL,
  `Ville` VARCHAR(45) NULL,
  `Point_Image` VARCHAR(255) NULL,
  `is_Confirme` TINYINT NULL DEFAULT 0,
  PRIMARY KEY (`idPoint_RDV`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `PCP21`.`Covoitureur`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `PCP21`.`Covoitureur` (
  `idCovoitureur` INT NOT NULL AUTO_INCREMENT,
  `Nom` VARCHAR(45) NULL,
  `Prenom` VARCHAR(45) NULL,
  `Utilisateur_Image` VARCHAR(255) NULL,
  `Num_Telephone` VARCHAR(45) NULL,
  `Email` VARCHAR(45) NULL,
  `Mot_De_Passe` VARCHAR(255) NULL,
  `Nbr_Alveoles` INT NULL,
  `is_Confirme` TINYINT NULL DEFAULT 0,
  `is_Webmaster` TINYINT NULL,
  `idPoint_RDV` INT NOT NULL,
  PRIMARY KEY (`idCovoitureur`),
  INDEX `fk_Covoitureur_Point1_idx` (`idPoint_RDV` ASC),
  CONSTRAINT `fk_Covoitureur_Point1`
    FOREIGN KEY (`idPoint_RDV`)
    REFERENCES `PCP21`.`Point_RDV` (`idPoint_RDV`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `PCP21`.`Voiture`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `PCP21`.`Voiture` (
  `idVoiture` INT NOT NULL AUTO_INCREMENT,
  `Modele` VARCHAR(45) NULL,
  `Marque` VARCHAR(45) NULL,
  `Annee` YEAR NULL,
  `Couleur` VARCHAR(45) NULL,
  `Nbr_Place` INT NULL,
  `Voiture_Image` VARCHAR(255) NULL,
  `is_Favoris` TINYINT NULL DEFAULT 0,
  `idCovoitureur` INT NOT NULL,
  PRIMARY KEY (`idVoiture`),
  INDEX `fk_Voiture_Covoitureur1_idx` (`idCovoitureur` ASC),
  CONSTRAINT `fk_Voiture_Covoitureur1`
    FOREIGN KEY (`idCovoitureur`)
    REFERENCES `PCP21`.`Covoitureur` (`idCovoitureur`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `PCP21`.`Ligne`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `PCP21`.`Ligne` (
  `idLigne` INT NOT NULL AUTO_INCREMENT,
  `Nom` VARCHAR(45) NULL,
  `Nbr_Points` INT NULL,
  PRIMARY KEY (`idLigne`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `PCP21`.`Covoiturage`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `PCP21`.`Covoiturage` (
  `idCovoiturage` INT NOT NULL AUTO_INCREMENT,
  `Jour` VARCHAR(45) NULL,
  `Heure` TIME NULL,
  `is_Depart_Lycee` TINYINT NULL,
  `idLigne` INT NOT NULL,
  PRIMARY KEY (`idCovoiturage`),
  INDEX `fk_Covoiturage_Ligne1_idx` (`idLigne` ASC),
  CONSTRAINT `fk_Covoiturage_Ligne1`
    FOREIGN KEY (`idLigne`)
    REFERENCES `PCP21`.`Ligne` (`idLigne`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `PCP21`.`Participation`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `PCP21`.`Participation` (
  `idParticipation` INT NOT NULL AUTO_INCREMENT,
  `is_Conducteur` TINYINT NULL,
  `Date` DATETIME NULL,
  `is_Valide_Systeme` TINYINT NULL,
  `is_Invalide_Webmaster` TINYINT NULL,
  `Kilometrage` INT NULL,
  `idCovoitureur` INT NOT NULL,
  `idCovoiturage` INT NOT NULL,
  PRIMARY KEY (`idParticipation`),
  INDEX `fk_Participation_Utilisateur1_idx` (`idCovoitureur` ASC),
  INDEX `fk_Participation_Covoiturage1_idx` (`idCovoiturage` ASC),
  CONSTRAINT `fk_Participation_Utilisateur1`
    FOREIGN KEY (`idCovoitureur`)
    REFERENCES `PCP21`.`Covoitureur` (`idCovoitureur`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Participation_Covoiturage1`
    FOREIGN KEY (`idCovoiturage`)
    REFERENCES `PCP21`.`Covoiturage` (`idCovoiturage`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `PCP21`.`Etape`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `PCP21`.`Etape` (
  `idEtape` INT NOT NULL AUTO_INCREMENT,
  `Duree` TIME NULL,
  `Kilometrage` INT NULL,
  `idPoint_RDV_A` INT NOT NULL,
  `idPoint_RDV_B` INT NOT NULL,
  `idVoiture` INT NOT NULL,
  `idParticipation` INT NOT NULL,
  PRIMARY KEY (`idEtape`),
  INDEX `fk_Etape_Point1_idx` (`idPoint_RDV_A` ASC),
  INDEX `fk_Etape_Point2_idx` (`idPoint_RDV_B` ASC),
  INDEX `fk_Etape_Voiture1_idx` (`idVoiture` ASC),
  INDEX `fk_Etape_Participation1_idx` (`idParticipation` ASC),
  CONSTRAINT `fk_Etape_Point1`
    FOREIGN KEY (`idPoint_RDV_A`)
    REFERENCES `PCP21`.`Point_RDV` (`idPoint_RDV`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Etape_Point2`
    FOREIGN KEY (`idPoint_RDV_B`)
    REFERENCES `PCP21`.`Point_RDV` (`idPoint_RDV`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Etape_Voiture1`
    FOREIGN KEY (`idVoiture`)
    REFERENCES `PCP21`.`Voiture` (`idVoiture`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Etape_Participation1`
    FOREIGN KEY (`idParticipation`)
    REFERENCES `PCP21`.`Participation` (`idParticipation`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `PCP21`.`Composition`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `PCP21`.`Composition` (
  `idComposition` INT NOT NULL AUTO_INCREMENT,
  `Rang` INT NULL,
  `idPoint_RDV` INT NOT NULL,
  `idLigne` INT NOT NULL,
  PRIMARY KEY (`idComposition`),
  INDEX `fk_Composition_Point1_idx` (`idPoint_RDV` ASC),
  INDEX `fk_Composition_Trajet1_idx` (`idLigne` ASC),
  CONSTRAINT `fk_Composition_Point1`
    FOREIGN KEY (`idPoint_RDV`)
    REFERENCES `PCP21`.`Point_RDV` (`idPoint_RDV`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Composition_Trajet1`
    FOREIGN KEY (`idLigne`)
    REFERENCES `PCP21`.`Ligne` (`idLigne`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `PCP21`.`Indisponibilite`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `PCP21`.`Indisponibilite` (
  `idIndisponibilite` INT NOT NULL AUTO_INCREMENT,
  `Debut_Fermeture` DATE NULL,
  `Fin_Fermeture` DATE NULL,
  `Motif_Fermeture` VARCHAR(45) NULL,
  PRIMARY KEY (`idIndisponibilite`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `PCP21`.`Inscription`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `PCP21`.`Inscription` (
  `idInscription` INT NOT NULL AUTO_INCREMENT,
  `idCovoitureur` INT NOT NULL,
  `idCovoiturage` INT NOT NULL,
  `Date_Depart` DATE NULL,
  `Semaine` VARCHAR(1) NULL,
  `is_Unique` TINYINT NULL,
  `is_Depart_Lycee` TINYINT NULL,
  `Jour_Semaine` VARCHAR(45) NULL,
  `Heure_Arrivee` TIME NULL,
  PRIMARY KEY (`idInscription`),
  INDEX `fk_Inscription_Covoitureur1_idx` (`idCovoitureur` ASC),
  INDEX `fk_Inscription_Covoiturage1_idx` (`idCovoiturage` ASC),
  CONSTRAINT `fk_Inscription_Covoitureur1`
    FOREIGN KEY (`idCovoitureur`)
    REFERENCES `PCP21`.`Covoitureur` (`idCovoitureur`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Inscription_Covoiturage1`
    FOREIGN KEY (`idCovoiturage`)
    REFERENCES `PCP21`.`Covoiturage` (`idCovoiturage`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `PCP21`.`Token`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `PCP21`.`Token` (
  `idToken` INT NOT NULL AUTO_INCREMENT,
  `Content` VARCHAR(255) NULL,
  `Date_Creation` DATETIME NULL,
  `Date_Fin` DATETIME NULL,
  `idCovoitureur` INT NOT NULL,
  PRIMARY KEY (`idToken`),
  INDEX `fk_Token_Covoitureur1_idx` (`idCovoitureur` ASC),
  CONSTRAINT `fk_Token_Covoitureur1`
    FOREIGN KEY (`idCovoitureur`)
    REFERENCES `PCP21`.`Covoitureur` (`idCovoitureur`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;



-- --------------------------------
--  Insertion des informations 
-- --------------------------------

INSERT INTO `Point_RDV` (`idPoint_RDV`, `Nom`, `Latitude`, `Longitude`, `Adresse`, `Ville`, `Point_Image`, `is_Confirme`) VALUES
(1, 'Lycée Charles Poncet', 46.06178, 6.57994, '1 Avenue Charles Poncet', '74300 Cluses', NULL, 1),
(2, 'Parking Relais - Villy-le-Pelloux', 45.99306, 6.12862, '28-114 Impasse des Glaises', '74370 Villy-le-Pelloux', NULL, 1),
(3, 'Mairie de La-Roche-sur-Foron', 46.06695, 6.31201, '1 place de l\'hotel de ville', '74800 La-Roche-sur-Foron', NULL, 1),
(4, 'Gare de Bonneville', 46.07799, 6.41669, '299 Avenue de la Gare', '74130 Bonneville', NULL, 1),
(5, 'Place du Bourgeal - Mont-Saxonnex', 46.05249, 6.48505, 'Place du Bourgeal', '74130 Mont-Saxonnex', NULL, 1),
(6, 'Gare de Saint-Gervais', 45.90609, 6.70033, 'Impasses des deux gares', '74170 Saint-Gervais-les-Bains', NULL, 1),
(7, 'P+R de Passy', 45.91341, 6.68971, 'Autoroute Blanche, Sortie 21 en direction d\'A', '74190 Passy', NULL, 1),
(8, 'Gare de Sallanches', 45.93529, 6.63405, 'Avenue de la gare', '74700 Sallanches', NULL, 1),
(9, 'Aire de stationnement de Morillon', 46.08620, 6.67921, 'Lac Bleu', '74440 Morillon', NULL, 1),
(10, 'Mairie de Mieussy', 46.13373, 6.52368, '1 place de la Mairie', '74440 Mieussy', NULL, 1),
(11, 'Salle des fêtes de Tanninges', 46.10545, 6.59072, '223 Avenue des Thézières', '74440 Taninges', NULL, 1),
(12, 'Mairie de Châtillon-sur-Cluses', 46.08778, 6.58280, 'Place de la Mairie', '74300 Châtillon-sur-Cluses', NULL, 1),
(13, 'Mairie de Nangy', 46.15457, 6.30570, '6-26 D298A', '74380 Nangy', NULL, 1),
(14, 'Pont du Risse - Saint-Jeoire', 46.13621, 6.47774, 'D907', '74490 Saint-Jeoire', NULL, 1),
(15, 'Cours de l\'Ets Mojon Fer et Métaux - Thyez', 46.08787, 6.51535, '3225 Avenu Vallées', '74300 Thyez', NULL, 1);

INSERT INTO `Ligne` (`idLigne`, `Nom`, `Nbr_Points`) VALUES
(1, 'Annecy', 4),
(2, 'Le Fayet', 4),
(3, 'Nangy', 4),
(4, 'Mieussy', 4),
(5, 'Morillon', 4),
(6, 'Mont Saxonnex', 2);

INSERT INTO `Composition` (`idComposition`, `Rang`, `idPoint_RDV`, `idLigne`) VALUES
(1, 4, 2, 1),
(2, 3, 3, 1),
(3, 2, 4, 1),
(4, 1, 1, 1),
(5, 4, 6, 2),
(6, 3, 7, 2),
(7, 2, 8, 2),
(8, 1, 1, 2),
(9, 4, 13, 3),
(10, 3, 14, 3),
(11, 2, 15, 3),
(12, 1, 1, 3),
(13, 4, 10, 4),
(14, 3, 11, 4),
(15, 2, 12, 4),
(16, 1, 1, 4),
(17, 4, 9, 5),
(18, 3, 11, 5),
(19, 2, 12, 5),
(20, 1, 1, 5),
(21, 2, 5, 6),
(22, 1, 1, 6);

INSERT INTO `Covoitureur` (`idCovoitureur`, `Nom`, `Prenom`, `Utilisateur_Image`, `Num_Telephone`, `Email`, `Mot_De_Passe`, `Nbr_Alveoles`, `is_Confirme`, `is_Webmaster`, `idPoint_RDV`) VALUES 
(NULL, 'Cyril', 'Leblanc', NULL, '0622130565', 'hulerique@live.fr', '$2y$10$QNbkYNaamfqCEDcDsI14DufXIUA/dP1laG9bt6ATqKR/xnSX/dpaq', '0', '1', '1', '3');